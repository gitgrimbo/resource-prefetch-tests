<!doctype html>

<style>
  html,
  body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
  }
</style>

<iframe id="results-frame" style="width:99%;height:80%" src="results/results.html"></iframe>

<div style="height:20%">

  <button id="start-tests">Start</button>

  <textarea id="results"></textarea>

  <hr>

  <div id="prefetch-container"></div>

  <hr>

  <a href="http://www.nasa.gov/image-feature/tectonically-active-planet-mercury">Images from NASA</a>

</div>

<!-- For IE9, etc -->
<script src="vendor/es6-object-assign.js"></script>
<script>
window.ObjectAssign.polyfill();
</script>
<script src="vendor/console-polyfill.js"></script>
<script src="vendor/bluebird.js"></script>
<script>
// http://stackoverflow.com/a/2880929/319878
var urlParams;
function getUrlParams(query) {
  var match,
    pl = /\+/g,  // Regex for replacing addition symbol with a space
    search = /([^&=]+)=?([^&]*)/g,
    decode = function(s) { return decodeURIComponent(s.replace(pl, " ")); };

  var urlParams = {};
  while (match = search.exec(query))
    urlParams[decode(match[1])] = decode(match[2]);
  return urlParams;
}
(window.onpopstate = function() {
  var query = window.location.search.substring(1);
  urlParams = getUrlParams(query);
})();

// App
require = {
  paths: {
    jquery: "vendor/jquery",
    mustache: "vendor/mustache"
  },
  deps: ["./App", "./resources"],
  callback: function(App, resources) {
    var prefetchContainer = $("#prefetch-container")[0];
    var frame = $("#results-frame")[0];
    var resultsTableElement = $("#results-table", frame.contentWindow.document)[0];
    var resultsTextareaElement = $("#results")[0];
    var app = new App(resources, prefetchContainer, resultsTableElement, resultsTextareaElement, urlParams);
    if (urlParams.autostart === "true") {
      app.startTest();
    }
    $("#start-tests").click(function() {
      app.startTest();
    });
  }
};
</script>
<script src="vendor/require.js"></script>
